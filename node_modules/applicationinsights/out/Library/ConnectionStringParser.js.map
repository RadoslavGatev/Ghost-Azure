{"version":3,"file":"ConnectionStringParser.js","sourceRoot":"","sources":["../../Library/ConnectionStringParser.ts"],"names":[],"mappings":";AACA,qDAAwD;AAExD;IAAA;IAuCA,CAAC;IAnCiB,4BAAK,GAAnB,UAAoB,gBAAyB;QACzC,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC;YACpB,MAAM,CAAC,EAAE,CAAC;QACd,CAAC;QAED,IAAM,OAAO,GAAG,gBAAgB,CAAC,KAAK,CAAC,sBAAsB,CAAC,iBAAiB,CAAC,CAAC;QAEjF,IAAM,MAAM,GAAqB,OAAO,CAAC,MAAM,CAAC,UAAC,MAAwB,EAAE,EAAU;YACjF,IAAM,OAAO,GAAG,EAAE,CAAC,KAAK,CAAC,sBAAsB,CAAC,0BAA0B,CAAC,CAAC;YAE5E,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;gBACvB,IAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,WAAW,EAAyB,CAAC;gBAC5D,IAAM,KAAK,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;gBACzB,MAAM,CAAC,GAAG,CAAC,GAAG,KAAe,CAAC;YAClC,CAAC;YACD,MAAM,CAAC,MAAM,CAAC;QAClB,CAAC,EAAE,EAAE,CAAC,CAAC;QAEP,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACjC,0DAA0D;YAE1D,EAAE,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;gBACxB,uDAAuD;gBACvD,IAAM,cAAc,GAAG,MAAM,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,GAAG,GAAG,GAAG,EAAE,CAAC;gBACpE,MAAM,CAAC,iBAAiB,GAAG,MAAM,CAAC,iBAAiB,IAAI,CAAC,UAAU,GAAG,cAAc,GAAG,KAAK,GAAG,MAAM,CAAC,cAAc,CAAC,CAAC;gBACrH,MAAM,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,IAAI,CAAC,UAAU,GAAG,cAAc,GAAG,OAAO,GAAG,MAAM,CAAC,cAAc,CAAC,CAAC;YACjH,CAAC;YAED,8BAA8B;YAC9B,MAAM,CAAC,iBAAiB,GAAG,MAAM,CAAC,iBAAiB,IAAI,SAAS,CAAC,uBAAuB,CAAC;YACzF,MAAM,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,IAAI,SAAS,CAAC,4BAA4B,CAAC;QACxF,CAAC;QAED,MAAM,CAAC,MAAM,CAAC;IAClB,CAAC;IArCc,wCAAiB,GAAG,GAAG,CAAC;IACxB,iDAA0B,GAAG,GAAG,CAAC;IAqCpD,6BAAC;CAAA,AAvCD,IAuCC;AAED,iBAAS,sBAAsB,CAAC","sourcesContent":["import { ConnectionString, ConnectionStringKey } from \"../Declarations/Contracts\";\r\nimport Constants = require(\"../Declarations/Constants\");\r\n\r\nclass ConnectionStringParser {\r\n    private static _FIELDS_SEPARATOR = \";\";\r\n    private static _FIELD_KEY_VALUE_SEPARATOR = \"=\";\r\n\r\n    public static parse(connectionString?: string): ConnectionString {\r\n        if (!connectionString) {\r\n            return {};\r\n        }\r\n\r\n        const kvPairs = connectionString.split(ConnectionStringParser._FIELDS_SEPARATOR);\r\n\r\n        const result: ConnectionString = kvPairs.reduce((fields: ConnectionString, kv: string) => {\r\n            const kvParts = kv.split(ConnectionStringParser._FIELD_KEY_VALUE_SEPARATOR);\r\n\r\n            if (kvParts.length === 2) { // only save fields with valid formats\r\n                const key = kvParts[0].toLowerCase() as ConnectionStringKey;\r\n                const value = kvParts[1];\r\n                fields[key] = value as string;\r\n            }\r\n            return fields;\r\n        }, {});\r\n\r\n        if (Object.keys(result).length > 0) {\r\n            // this is a valid connection string, so parse the results\r\n\r\n            if (result.endpointsuffix) {\r\n                // use endpoint suffix where overrides are not provided\r\n                const locationPrefix = result.location ? result.location + \".\" : \"\";\r\n                result.ingestionendpoint = result.ingestionendpoint || (\"https://\" + locationPrefix + \"dc.\" + result.endpointsuffix);\r\n                result.liveendpoint = result.liveendpoint || (\"https://\" + locationPrefix + \"live.\" + result.endpointsuffix);\r\n            }\r\n\r\n            // apply the default endpoints\r\n            result.ingestionendpoint = result.ingestionendpoint || Constants.DEFAULT_BREEZE_ENDPOINT;\r\n            result.liveendpoint = result.liveendpoint || Constants.DEFAULT_LIVEMETRICS_ENDPOINT;\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nexport = ConnectionStringParser;\r\n"]}