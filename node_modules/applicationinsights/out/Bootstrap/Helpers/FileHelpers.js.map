{"version":3,"file":"FileHelpers.js","sourceRoot":"","sources":["../../../Bootstrap/Helpers/FileHelpers.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nimport * as path from \"path\";\r\nimport * as fs from \"fs\";\r\nimport * as os from \"os\";\r\n\r\nexport const homedir = os.homedir ? os.homedir() : (process.env[(process.platform == \"win32\") ? \"USERPROFILE\" : \"HOME\"]);\r\n\r\n/**\r\n * Zero dependencies: recursive mkdir\r\n */\r\nfunction mkDirByPathSync(HOME_DIR: string, targetDir: string, { isRelativeToScript = false } = {}) {\r\n    const sep = path.sep;\r\n    const initDir = path.isAbsolute(targetDir) ? sep : \"\";\r\n    const baseDir = isRelativeToScript ? __dirname : \".\";\r\n\r\n    return targetDir.split(sep).reduce((parentDir, childDir) => {\r\n        const curDir = path.resolve(baseDir, parentDir, childDir);\r\n        try {\r\n            // Don't try to recreate homedir\r\n            if (HOME_DIR.indexOf(curDir) === -1) {\r\n                fs.mkdirSync(curDir);\r\n            }\r\n        } catch (err) {\r\n            if (err.code === \"EEXIST\") { // curDir already exists!\r\n                return curDir;\r\n            }\r\n\r\n            // To avoid `EISDIR` error on Mac and `EACCES`-->`ENOENT` and `EPERM` on Windows.\r\n            if (err.code === \"ENOENT\") { // Throw the original parentDir error on curDir `ENOENT` failure.\r\n                throw new Error(`EACCES: permission denied, mkdir \"${parentDir}\"`);\r\n            }\r\n\r\n            const caughtErr = [\"EACCES\", \"EPERM\", \"EISDIR\"].indexOf(err.code) > -1;\r\n            if (!caughtErr || caughtErr && curDir === path.resolve(targetDir)) {\r\n                throw err; // Throw if it's just the last created dir.\r\n            }\r\n        }\r\n        return curDir;\r\n\r\n    }, initDir);\r\n}\r\n\r\nexport function makeStatusDirs(filepath: string): boolean {\r\n    try {\r\n        mkDirByPathSync(homedir, filepath.replace(/\\\\/g, path.sep).replace(/\\//g, path.sep));\r\n        return true;\r\n    } catch (e) {\r\n        console.error(\"Error creating Application Insights status folder\", e);\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n\r\nexport function renameCurrentFile(filepath: string, filename: string, callback?: (err: Error | null, destfullpath?: string) => void): void {\r\n    const fullpath = path.join(filepath, filename);\r\n    const basename = path.basename(filename, path.extname(filename));\r\n    const stats = fs.stat(fullpath, (statsErr, stats) => {\r\n        if (statsErr) {\r\n            return callback(statsErr);\r\n        }\r\n\r\n        const createDate = new Date(stats.birthtime);\r\n        const destfilename = basename + \"-\" +\r\n            createDate.toISOString().replace(/[T:\\.]/g, \"_\").replace(\"Z\", \"\") +\r\n            path.extname(filename) + \".old\";\r\n        const destfullpath = path.join(filepath, destfilename);\r\n        fs.rename(fullpath, destfullpath, (renameErr) => {\r\n            if (typeof callback === \"function\") {\r\n                callback(renameErr, destfullpath);\r\n            }\r\n        });\r\n    });\r\n}\r\n"]}